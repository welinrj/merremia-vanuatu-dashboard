<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vanuatu NBSAP GIS Portal</title>
  <meta name="description" content="National Biodiversity Strategy and Action Plan - GIS Data Portal & Dashboard for Vanuatu. Target 3 (30x30) monitoring.">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒ¿</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script type="module" crossorigin src="./assets/index-CEFEtWLn.js"></script>
  <link rel="modulepreload" crossorigin href="./assets/turf-DoSnX_XS.js">
  <link rel="modulepreload" crossorigin href="./assets/leaflet-CUUxycQw.js">
  <link rel="stylesheet" crossorigin href="./assets/index-r7tAeIe8.css">
</head>
<body>
  <div class="app-container">
    <!-- Top Header Bar -->
    <header class="header-bar">
      <div class="header-top">
        <div class="header-brand">
          <div class="brand-icon">
            <svg width="36" height="36" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="1.5" opacity="0.3"/>
              <path d="M20 6C20 6 12 14 12 22C12 26.4 15.6 30 20 30C24.4 30 28 26.4 28 22C28 14 20 6 20 6Z" fill="currentColor" opacity="0.6"/>
              <path d="M20 10C20 10 15 16 15 21C15 23.8 17.2 26 20 26C22.8 26 25 23.8 25 21C25 16 20 10 20 10Z" fill="currentColor"/>
            </svg>
          </div>
          <div class="brand-text">
            <div class="brand-title">Vanuatu NBSAP</div>
            <div class="brand-subtitle">GIS Data Portal & 30x30 Dashboard</div>
          </div>
        </div>
        <div class="header-right">
          <div class="auth-badge" id="auth-badge" title="Click Admin tab to login">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span>Public</span>
          </div>
        </div>
      </div>
      <nav class="header-nav">
        <button class="nav-tab active" data-tab="dashboard">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          Dashboard
        </button>
        <button class="nav-tab" data-tab="portal">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4"/><polyline points="14 2 14 8 20 8"/><path d="M3 15h6"/><path d="M6 12v6"/></svg>
          Data Portal
        </button>
        <button class="nav-tab" data-tab="admin">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m-7-11l5.2 3m3.6 2.1L19 23M1 17l5.2-3m3.6-2.1L19 1M1 7l5.2 3"/></svg>
          Admin
        </button>
        <button class="nav-tab" data-tab="about">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          About
        </button>
      </nav>
    </header>

    <!-- Page Containers (pre-populated with loading states) -->
    <div class="page-container">
      <div id="page-dashboard" class="page active">
        <div class="loading-state" id="loading-dashboard">
          <div class="loading-spinner"></div>
          <p>Loading dashboard...</p>
        </div>
      </div>
      <div id="page-portal" class="page">
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading data portal...</p>
        </div>
      </div>
      <div id="page-admin" class="page">
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading admin panel...</p>
        </div>
      </div>
      <div id="page-about" class="page">
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Upload Wizard Modal -->
  <div class="modal-overlay" id="upload-wizard-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          <h3>Upload Shapefile</h3>
        </div>
        <button class="modal-close" onclick="document.getElementById('upload-wizard-modal').classList.remove('active')" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="wizard-steps" id="wizard-steps"></div>
        <div id="wizard-body"></div>
      </div>
    </div>
  </div>

  <script>
    // Catch both sync errors and unhandled promise rejections
    window.__nbsapLoaded = false;
    function showLoadError(msg) {
      var el = document.getElementById('page-dashboard');
      if (el && !window.__nbsapLoaded) {
        el.innerHTML = '<div style="padding:40px;max-width:600px;margin:0 auto">' +
          '<h2 style="color:#065f46;margin-bottom:12px">Loading Error</h2>' +
          '<p style="color:#64748b;font-size:14px;line-height:1.6;margin-bottom:16px">' + msg + '</p>' +
          '<p style="color:#94a3b8;font-size:13px">Try refreshing the page. If this persists, the app may need to be built first: run <code style="background:#f1f5f9;padding:2px 6px;border-radius:4px">npm run dev</code> from the <code style="background:#f1f5f9;padding:2px 6px;border-radius:4px">nbsap-portal</code> directory.</p>' +
          '</div>';
      }
    }
    window.addEventListener('error', function(e) { showLoadError(e.message || 'Unknown error'); });
    window.addEventListener('unhandledrejection', function(e) { showLoadError(e.reason ? (e.reason.message || String(e.reason)) : 'Module loading failed'); });
    // Timeout fallback: if app hasn't loaded in 10s, show help
    setTimeout(function() {
      if (!window.__nbsapLoaded) {
        showLoadError('Application failed to load within 10 seconds. This may indicate a network or build issue.');
      }
    }, 10000);
  </script>
</body>
</html>
