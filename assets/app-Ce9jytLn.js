import{j as e,f as k,r as i,p as H,a as q,b as Q,c as A,M as z,A as Y,l as B,m as J,d as _,g as U,u as W,e as X,i as Z,h as ee,H as ae,k as te}from"./App-NfJZ_7BI.js";const se=[{id:"overview",label:"Overview"},{id:"data-portal",label:"Data Portal"},{id:"gis-database",label:"GIS Database"},{id:"sightings",label:"Sightings"},{id:"locations",label:"Locations"},{id:"species",label:"Species"},{id:"settings",label:"Settings"}],ne="/merremia-vanuatu-dashboard/public.html",le=({activeSection:a,onNavigate:s})=>e.jsxs("aside",{className:"sidebar",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h2",{children:"VCAP2"}),e.jsx("span",{className:"sidebar-subtitle",children:"In-House Portal"})]}),e.jsx("nav",{className:"sidebar-nav",children:e.jsx("ul",{children:se.map(l=>e.jsx("li",{children:e.jsx("button",{className:`nav-item ${a===l.id?"active":""}`,onClick:()=>s(l.id),title:l.label,children:l.label})},l.id))})}),e.jsx("div",{className:"sidebar-footer",children:e.jsx("a",{href:ne,className:"nav-item public-portal-link",target:"_blank",rel:"noopener noreferrer",children:"Public Portal →"})})]}),ie=({data:a})=>{const s=a.change!==void 0?a.change>0?"positive":a.change<0?"negative":"neutral":"";return e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"stat-title",children:a.title}),e.jsxs("span",{className:"stat-value",children:[a.value,a.unit&&e.jsx("span",{className:"stat-unit",children:a.unit})]}),a.change!==void 0&&e.jsxs("span",{className:`stat-change ${s}`,children:[a.change>0?"+":"",a.change,"%"]})]})},T=({sightings:a})=>e.jsxs("div",{className:"table-container",children:[e.jsx("h3",{children:"Recent Sightings"}),e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Location"}),e.jsx("th",{children:"Species"}),e.jsx("th",{children:"Count"}),e.jsx("th",{children:"Observer"})]})}),e.jsx("tbody",{children:a.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.date}),e.jsx("td",{children:s.location}),e.jsx("td",{className:"species-name",children:s.species}),e.jsx("td",{children:s.count}),e.jsx("td",{children:s.observer})]},s.id))})]})]}),M=({locations:a})=>e.jsxs("div",{className:"location-list",children:[e.jsx("h3",{children:"Locations"}),e.jsx("ul",{children:a.map(s=>e.jsxs("li",{className:"location-item",children:[e.jsx("span",{className:"location-name",children:s.name}),e.jsxs("div",{className:"location-stats",children:[e.jsxs("span",{children:[s.totalSightings," sightings"]}),e.jsxs("span",{children:[s.speciesCount," species"]})]})]},s.name))})]}),re={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[168.3273,-17.7333]},properties:{species:"Acropora millepora",count:45,observer:"Dr. Tari",date:"2026-02-07",location:"Efate Island",habitat:"Reef crest"}},{type:"Feature",geometry:{type:"Point",coordinates:[169.2833,-19.5167]},properties:{species:"Chelonia mydas",count:23,observer:"M. Kalsakau",date:"2026-02-06",location:"Tanna Island",habitat:"Nesting beach"}},{type:"Feature",geometry:{type:"Point",coordinates:[167.1667,-15.4333]},properties:{species:"Dugong dugon",count:3,observer:"Dr. Tari",date:"2026-02-05",location:"Santo Island",habitat:"Seagrass bed"}},{type:"Feature",geometry:{type:"Point",coordinates:[167.6833,-16.35]},properties:{species:"Porites lutea",count:67,observer:"J. Naupa",date:"2026-02-04",location:"Malekula Island",habitat:"Lagoon reef flat"}},{type:"Feature",geometry:{type:"Point",coordinates:[168.3119,-17.7417]},properties:{species:"Tridacna gigas",count:8,observer:"S. Vatu",date:"2026-02-03",location:"Efate Island",habitat:"Reef edge"}},{type:"Feature",geometry:{type:"Point",coordinates:[168.15,-16.2667]},properties:{species:"Acropora hyacinthus",count:34,observer:"R. Mele",date:"2026-02-01",location:"Ambrym Island",habitat:"Fringing reef"}},{type:"Feature",geometry:{type:"Point",coordinates:[168.1833,-15.7667]},properties:{species:"Eretmochelys imbricata",count:4,observer:"L. Bong",date:"2026-01-29",location:"Pentecost Island",habitat:"Coral reef slope"}},{type:"Feature",geometry:{type:"Point",coordinates:[168.3065,-17.7476]},properties:{species:"Hippocampus kuda",count:5,observer:"Dr. Tari",date:"2026-01-27",location:"Port Vila",habitat:"Mangrove channel"}}]},ce={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[168.2,-17.6],[168.5,-17.6],[168.5,-17.85],[168.2,-17.85],[168.2,-17.6]]]},properties:{name:"Efate Island",province:"Shefa",area_km2:899,population:65e3,survey_status:"Complete"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[169.1,-19.4],[169.5,-19.4],[169.5,-19.65],[169.1,-19.65],[169.1,-19.4]]]},properties:{name:"Tanna Island",province:"Tafea",area_km2:550,population:29e3,survey_status:"In Progress"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[166.5,-15.1],[167.3,-15.1],[167.3,-15.7],[166.5,-15.7],[166.5,-15.1]]]},properties:{name:"Espiritu Santo",province:"Sanma",area_km2:3956,population:4e4,survey_status:"In Progress"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[167.4,-16],[167.9,-16],[167.9,-16.6],[167.4,-16.6],[167.4,-16]]]},properties:{name:"Malekula Island",province:"Malampa",area_km2:2041,population:3e4,survey_status:"Planned"}}]},oe={active:"badge badge-active",archived:"badge badge-archived",draft:"badge badge-draft"},de=({datasets:a,onView:s,onEdit:l,onDelete:d})=>a.length===0?e.jsx("div",{className:"portal-empty",children:e.jsx("p",{children:"No datasets yet. Upload a GeoJSON, CSV, or KML file to get started."})}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Format"}),e.jsx("th",{children:"Features"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Updated"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:a.map(n=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("button",{className:"link-button",onClick:()=>s(n.id),children:n.metadata.name}),n.metadata.description&&e.jsx("span",{className:"dataset-description",children:n.metadata.description})]}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-format",children:n.format.toUpperCase()})}),e.jsx("td",{children:n.featureCount.toLocaleString()}),e.jsx("td",{children:k(n.sizeBytes)}),e.jsx("td",{children:e.jsx("span",{className:oe[n.metadata.status]??"badge",children:n.metadata.status})}),e.jsx("td",{children:new Date(n.updatedAt).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm",onClick:()=>s(n.id),title:"View dataset",children:"View"}),e.jsx("button",{className:"btn btn-sm",onClick:()=>l(n.id),title:"Edit metadata",children:"Edit"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>d(n.id),title:"Delete dataset",children:"Delete"})]})})]},n.id))})]})});function G(a){const s=a.split(".").pop()?.toLowerCase();return s==="geojson"||s==="json"?"geojson":s==="csv"?"csv":s==="kml"?"kml":null}const K=({onUploaded:a,onCancel:s})=>{const[l,d]=i.useState(""),[n,m]=i.useState(""),[b,v]=i.useState(""),[p,x]=i.useState(null),[N,j]=i.useState(""),[f,g]=i.useState(!1),[y,o]=i.useState(!1),[u,C]=i.useState("latitude"),[r,P]=i.useState("longitude"),F=i.useRef(null),I=p?G(p.name):null;function E(c){if(!G(c.name)){j("Unsupported file format. Please use .geojson, .json, .csv, or .kml");return}x(c),j(""),l||d(c.name.replace(/\.[^.]+$/,""))}function O(c){c.preventDefault(),o(!1);const t=c.dataTransfer.files[0];t&&E(t)}async function R(c){if(c.preventDefault(),!(!p||!I)){g(!0),j("");try{const t=await p.text();let h;switch(I){case"geojson":h=Q(t);break;case"csv":h=q(t,u,r);break;case"kml":h=H(t);break}await A(h,{name:l,description:n,source:b},I),a()}catch(t){j(t instanceof Error?t.message:"Failed to parse file")}finally{g(!1)}}}return e.jsxs("div",{className:"upload-panel",children:[e.jsx("h3",{children:"Upload Dataset"}),e.jsxs("form",{onSubmit:R,children:[e.jsxs("div",{className:`drop-zone ${y?"drag-over":""} ${p?"has-file":""}`,onDragOver:c=>{c.preventDefault(),o(!0)},onDragLeave:()=>o(!1),onDrop:O,onClick:()=>F.current?.click(),role:"button",tabIndex:0,onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),F.current?.click())},children:[e.jsx("input",{ref:F,type:"file",accept:".geojson,.json,.csv,.kml",onChange:c=>{const t=c.target.files?.[0];t&&E(t)},hidden:!0}),p?e.jsxs("div",{className:"drop-zone-file",children:[e.jsx("span",{className:"badge badge-format",children:I?.toUpperCase()}),e.jsx("span",{children:p.name})]}):e.jsxs("div",{className:"drop-zone-prompt",children:[e.jsx("p",{children:"Drag & drop a file here, or click to browse"}),e.jsx("p",{className:"drop-zone-hint",children:"Supports GeoJSON, CSV, KML"})]})]}),I==="csv"&&e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lat-field",children:"Latitude Column"}),e.jsx("input",{id:"lat-field",type:"text",value:u,onChange:c=>C(c.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lng-field",children:"Longitude Column"}),e.jsx("input",{id:"lng-field",type:"text",value:r,onChange:c=>P(c.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ds-name",children:"Name"}),e.jsx("input",{id:"ds-name",type:"text",value:l,onChange:c=>d(c.target.value),placeholder:"Dataset name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ds-desc",children:"Description"}),e.jsx("textarea",{id:"ds-desc",value:n,onChange:c=>m(c.target.value),placeholder:"Brief description of the dataset",rows:2})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ds-source",children:"Source"}),e.jsx("input",{id:"ds-source",type:"text",value:b,onChange:c=>v(c.target.value),placeholder:"Data source or provider"})]}),N&&e.jsx("div",{className:"form-error",role:"alert",children:N}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:s,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!p||f,children:f?"Uploading...":"Upload Dataset"})]})]})]})},ue=({dataset:a,onBack:s,onEdit:l,onDelete:d})=>{const{metadata:n,data:m,properties:b}=a;function v(){const p=JSON.stringify(m,null,2),x=new Blob([p],{type:"application/geo+json"}),N=URL.createObjectURL(x),j=document.createElement("a");j.href=N,j.download=`${n.name.replace(/\s+/g,"_")}.geojson`,j.click(),URL.revokeObjectURL(N)}return e.jsxs("div",{className:"dataset-detail",children:[e.jsxs("div",{className:"detail-header",children:[e.jsx("button",{className:"btn btn-sm",onClick:s,children:"← Back"}),e.jsxs("div",{className:"detail-actions",children:[e.jsx("button",{className:"btn btn-sm",onClick:v,children:"Export GeoJSON"}),e.jsx("button",{className:"btn btn-sm",onClick:l,children:"Edit Metadata"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:d,children:"Delete"})]})]}),e.jsxs("div",{className:"detail-meta-card",children:[e.jsxs("div",{className:"detail-title-row",children:[e.jsx("h2",{children:n.name}),e.jsx("span",{className:`badge badge-${n.status}`,children:n.status})]}),n.description&&e.jsx("p",{className:"detail-description",children:n.description}),e.jsxs("div",{className:"detail-stats",children:[e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Format"}),e.jsx("span",{className:"detail-stat-value",children:a.format.toUpperCase()})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Features"}),e.jsx("span",{className:"detail-stat-value",children:a.featureCount.toLocaleString()})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Size"}),e.jsx("span",{className:"detail-stat-value",children:k(a.sizeBytes)})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"CRS"}),e.jsx("span",{className:"detail-stat-value",children:n.crs})]}),n.source&&e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Source"}),e.jsx("span",{className:"detail-stat-value",children:n.source})]}),n.license&&e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"License"}),e.jsx("span",{className:"detail-stat-value",children:n.license})]})]}),n.tags.length>0&&e.jsx("div",{className:"detail-tags",children:n.tags.map(p=>e.jsx("span",{className:"badge badge-tag",children:p},p))}),a.bbox&&e.jsxs("div",{className:"detail-bbox",children:[e.jsx("span",{className:"detail-stat-label",children:"Bounding Box"}),e.jsxs("code",{children:["[",a.bbox.map(p=>p.toFixed(4)).join(", "),"]"]})]})]}),e.jsxs("div",{className:"detail-map",children:[e.jsx("h3",{children:"Map Preview"}),e.jsx(z,{data:m,height:"450px"})]}),e.jsx(Y,{data:m,properties:b})]})},he=["active","archived","draft"],pe=({metadata:a,onSave:s,onCancel:l})=>{const[d,n]=i.useState(a.name),[m,b]=i.useState(a.description),[v,p]=i.useState(a.source),[x,N]=i.useState(a.license),[j,f]=i.useState(a.status),[g,y]=i.useState(a.crs),[o,u]=i.useState(a.tags.join(", "));function C(r){r.preventDefault();const P=o.split(",").map(F=>F.trim()).filter(Boolean);s({name:d,description:m,source:v,license:x,status:j,crs:g,tags:P})}return e.jsxs("div",{className:"editor-panel",children:[e.jsx("h3",{children:"Edit Dataset Metadata"}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-name",children:"Name"}),e.jsx("input",{id:"edit-name",type:"text",value:d,onChange:r=>n(r.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-desc",children:"Description"}),e.jsx("textarea",{id:"edit-desc",value:m,onChange:r=>b(r.target.value),rows:3})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-source",children:"Source"}),e.jsx("input",{id:"edit-source",type:"text",value:v,onChange:r=>p(r.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-license",children:"License"}),e.jsx("input",{id:"edit-license",type:"text",value:x,onChange:r=>N(r.target.value),placeholder:"e.g. CC-BY-4.0"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-status",children:"Status"}),e.jsx("select",{id:"edit-status",value:j,onChange:r=>f(r.target.value),children:he.map(r=>e.jsx("option",{value:r,children:r.charAt(0).toUpperCase()+r.slice(1)},r))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-crs",children:"CRS"}),e.jsx("input",{id:"edit-crs",type:"text",value:g,onChange:r=>y(r.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-tags",children:"Tags (comma-separated)"}),e.jsx("input",{id:"edit-tags",type:"text",value:o,onChange:r=>u(r.target.value),placeholder:"vcap2, marine, vanuatu, survey"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:l,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Changes"})]})]})]})},me=({onNavigate:a})=>{const[s,l]=i.useState("list"),[d,n]=i.useState([]),[m,b]=i.useState(null),[v,p]=i.useState(!0),x=i.useCallback(async()=>{const o=await B();n(o)},[]);i.useEffect(()=>{let o=!1;return J().then(()=>{if(!o)return x()}).finally(()=>{o||p(!1)}),()=>{o=!0}},[x]);async function N(o){const u=await U(o);u?(b(u),l("detail")):(b(null),l("list"))}async function j(o){const u=await U(o);u?(b(u),l("edit")):(b(null),l("list"))}async function f(o){const u=d.find(r=>r.id===o);window.confirm(`Delete dataset "${u?.metadata.name??o}"? This cannot be undone.`)&&(await _(o),await x(),m?.id===o&&(b(null),l("list")))}async function g(o){if(!m)return;const u=await W(m.id,o);u&&(b(u),await x(),l("detail"))}async function y(){(await B()).some(u=>u.metadata.name==="VCAP2 Survey Points")||(await A(re,{name:"VCAP2 Survey Points",description:"Marine survey observation points across Vanuatu islands",source:"DEPC Field Survey 2026",tags:["vcap2","marine","survey","vanuatu"]},"geojson"),await A(ce,{name:"Island Survey Boundaries",description:"Survey area boundaries for major Vanuatu islands",source:"National GIS Office",tags:["boundaries","islands","survey-areas"]},"geojson"),await x())}return v?e.jsx("div",{className:"data-portal",children:e.jsx("div",{className:"portal-toolbar",children:e.jsxs("div",{className:"portal-toolbar-left",children:[e.jsx("h2",{children:"GIS Data Portal"}),e.jsx("span",{className:"dataset-count",children:"Loading..."})]})})}):e.jsxs("div",{className:"data-portal",children:[s==="list"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"portal-toolbar",children:[e.jsxs("div",{className:"portal-toolbar-left",children:[e.jsx("h2",{children:"GIS Data Portal"}),e.jsxs("span",{className:"dataset-count",children:[d.length," dataset",d.length!==1?"s":""]})]}),e.jsxs("div",{className:"portal-toolbar-right",children:[d.length===0&&e.jsx("button",{className:"btn btn-secondary",onClick:y,children:"Load Sample Data"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>l("upload"),children:"Upload Dataset"})]})]}),d.length>0&&a&&e.jsxs("div",{className:"db-import-status",style:{marginBottom:"1rem"},children:["All datasets are stored in the GIS Database.",e.jsx("button",{className:"btn btn-sm",style:{marginLeft:"auto"},onClick:()=>a("gis-database"),children:"Open GIS Database"})]}),e.jsx(de,{datasets:d,onView:N,onEdit:j,onDelete:f})]}),s==="upload"&&e.jsx(K,{onUploaded:async()=>{await x(),l("list")},onCancel:()=>l("list")}),s==="detail"&&m&&e.jsx(ue,{dataset:m,onBack:()=>{b(null),l("list")},onEdit:()=>l("edit"),onDelete:()=>f(m.id)}),s==="edit"&&m&&e.jsx(pe,{metadata:m.metadata,onSave:g,onCancel:()=>l(m?"detail":"list")})]})},xe=({onNavigate:a})=>{const[s,l]=i.useState("browse"),[d,n]=i.useState([]),[m,b]=i.useState(!0),[v,p]=i.useState(null),[x,N]=i.useState(null),[j,f]=i.useState(null),[g,y]=i.useState(null),[o,u]=i.useState(""),C=i.useRef(null),r=i.useCallback(async()=>{const t=await B();n(t);const h=await X();h&&(p(h.used),N(h.quota))},[]);i.useEffect(()=>{let t=!1;return J().then(()=>r()).finally(()=>{t||b(!1)}),()=>{t=!0}},[r]);const P=d.reduce((t,h)=>t+h.featureCount,0),F=d.reduce((t,h)=>t+h.sizeBytes,0);async function I(t){if(j===t){f(null),y(null);return}f(t);const h=await U(t);y(h)}async function E(t){const h=d.find(L=>L.id===t);window.confirm(`Delete "${h?.metadata.name}"? This cannot be undone.`)&&(await _(t),j===t&&(f(null),y(null)),await r())}async function O(){const t=await ee(),h=JSON.stringify(t,null,2),L=new Blob([h],{type:"application/json"}),S=URL.createObjectURL(L),D=document.createElement("a");D.href=S,D.download=`vcap2-gis-backup-${new Date().toISOString().slice(0,10)}.json`,D.click(),URL.revokeObjectURL(S)}async function R(t){const h=t.target.files?.[0];if(h){u("Importing...");try{const L=await h.text(),S=JSON.parse(L);let D;if(Array.isArray(S))D=S;else if(S.type==="FeatureCollection"||S.type==="Feature"||S.coordinates){u('This is a GIS file — use the "Upload Dataset" button to add it to the database.');return}else{u("Invalid backup file format.");return}const w=await Z(D);await r(),u(`Imported ${w.imported} dataset${w.imported!==1?"s":""}`+(w.skipped>0?`, ${w.skipped} already existed`:""))}catch{u("Failed to import — invalid file format.")}C.current&&(C.current.value="")}}async function c(t){const h=await U(t);if(!h)return;const L=JSON.stringify(h.data,null,2),S=new Blob([L],{type:"application/geo+json"}),D=URL.createObjectURL(S),w=document.createElement("a");w.href=D,w.download=`${h.metadata.name.replace(/\s+/g,"_")}.geojson`,w.click(),URL.revokeObjectURL(D)}return m?e.jsx("div",{className:"data-portal",children:e.jsx("div",{className:"portal-toolbar",children:e.jsxs("div",{className:"portal-toolbar-left",children:[e.jsx("h2",{children:"GIS Database"}),e.jsx("span",{className:"dataset-count",children:"Loading..."})]})})}):s==="upload"?e.jsx("div",{className:"data-portal",children:e.jsx(K,{onUploaded:async()=>{await r(),l("browse"),u("Dataset uploaded and stored to database.")},onCancel:()=>l("browse")})}):e.jsxs("div",{className:"data-portal",children:[e.jsxs("div",{className:"portal-toolbar",children:[e.jsxs("div",{className:"portal-toolbar-left",children:[e.jsx("h2",{children:"GIS Database"}),e.jsxs("span",{className:"dataset-count",children:[d.length," dataset",d.length!==1?"s":""," stored"]})]}),e.jsxs("div",{className:"portal-toolbar-right",children:[e.jsx("input",{ref:C,type:"file",accept:".json",onChange:R,hidden:!0}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>C.current?.click(),children:"Restore Backup"}),e.jsx("button",{className:"btn btn-secondary",onClick:O,disabled:d.length===0,children:"Export Backup"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>l("upload"),children:"Upload Dataset"})]})]}),o&&e.jsxs("div",{className:"db-import-status",role:"status",children:[o,e.jsx("button",{className:"db-dismiss",onClick:()=>u(""),"aria-label":"Dismiss",children:"×"})]}),e.jsxs("div",{className:"db-stats-grid",children:[e.jsxs("div",{className:"db-stat-card",children:[e.jsx("span",{className:"db-stat-value",children:d.length}),e.jsx("span",{className:"db-stat-label",children:"Datasets"})]}),e.jsxs("div",{className:"db-stat-card",children:[e.jsx("span",{className:"db-stat-value",children:P.toLocaleString()}),e.jsx("span",{className:"db-stat-label",children:"Total Features"})]}),e.jsxs("div",{className:"db-stat-card",children:[e.jsx("span",{className:"db-stat-value",children:k(F)}),e.jsx("span",{className:"db-stat-label",children:"Data Size"})]}),e.jsxs("div",{className:"db-stat-card",children:[e.jsx("span",{className:"db-stat-value",children:x?k(x-(v??0)):"N/A"}),e.jsx("span",{className:"db-stat-label",children:"Storage Available"})]})]}),v!=null&&x!=null&&x>0&&e.jsxs("div",{className:"db-storage-bar-container",children:[e.jsx("div",{className:"db-storage-bar",children:e.jsx("div",{className:"db-storage-bar-fill",style:{width:`${Math.min(v/x*100,100)}%`}})}),e.jsxs("span",{className:"db-storage-text",children:[k(v)," of ",k(x)," used"]})]}),d.length===0?e.jsxs("div",{className:"portal-empty",children:[e.jsx("p",{children:"No datasets in the database yet."}),e.jsxs("p",{style:{fontSize:"0.85rem",marginTop:"0.5rem"},children:["Click ",e.jsx("strong",{children:"Upload Dataset"})," to add GIS files (GeoJSON, CSV, KML), or use ",e.jsx("strong",{children:"Restore Backup"})," to import a previous export."]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center",marginTop:"1rem"},children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>l("upload"),children:"Upload Your First Dataset"}),a&&e.jsx("button",{className:"btn btn-secondary",onClick:()=>a("data-portal"),children:"Go to Data Portal"})]})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Format"}),e.jsx("th",{children:"Features"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Stored"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:d.map(t=>e.jsxs("tr",{className:j===t.id?"db-row-selected":"",children:[e.jsxs("td",{children:[e.jsx("button",{className:"link-button",onClick:()=>I(t.id),children:t.metadata.name}),t.metadata.description&&e.jsx("span",{className:"dataset-description",children:t.metadata.description})]}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-format",children:t.format.toUpperCase()})}),e.jsx("td",{children:t.featureCount.toLocaleString()}),e.jsx("td",{children:k(t.sizeBytes)}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-${t.metadata.status}`,children:t.metadata.status})}),e.jsx("td",{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm",onClick:()=>c(t.id),title:"Download as GeoJSON",children:"Download"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>E(t.id),title:"Delete from database",children:"Delete"})]})})]},t.id))})]})}),g&&e.jsxs("div",{className:"db-preview",children:[e.jsxs("div",{className:"db-preview-header",children:[e.jsxs("h3",{children:["Preview: ",g.metadata.name]}),e.jsx("button",{className:"btn btn-sm",onClick:()=>{f(null),y(null)},children:"Close"})]}),e.jsxs("div",{className:"db-preview-meta",children:[e.jsxs("span",{children:[g.featureCount," features"]}),e.jsx("span",{children:g.format.toUpperCase()}),e.jsx("span",{children:k(g.sizeBytes)}),g.bbox&&e.jsxs("span",{children:["Bbox: [",g.bbox.map(t=>t.toFixed(2)).join(", "),"]"]})]}),e.jsx(z,{data:g.data,height:"350px"})]})]})},je=[{title:"Total Surveys",value:1284,change:12.5},{title:"Species Recorded",value:23,change:4.3},{title:"Active Sites",value:8,change:0},{title:"Observers",value:15,change:-2.1}],V=[{id:"1",date:"2026-02-07",location:"Efate Island",species:"Acropora millepora",count:45,observer:"Dr. Tari",notes:"Healthy coral colony along reef crest"},{id:"2",date:"2026-02-06",location:"Tanna Island",species:"Chelonia mydas",count:23,observer:"M. Kalsakau"},{id:"3",date:"2026-02-05",location:"Santo Island",species:"Dugong dugon",count:3,observer:"Dr. Tari",notes:"Feeding in seagrass bed near estuary"},{id:"4",date:"2026-02-04",location:"Malekula Island",species:"Porites lutea",count:67,observer:"J. Naupa"},{id:"5",date:"2026-02-03",location:"Efate Island",species:"Tridacna gigas",count:8,observer:"S. Vatu",notes:"Giant clam cluster near reef edge"}],$=[{name:"Efate Island",totalSightings:412,speciesCount:8},{name:"Tanna Island",totalSightings:287,speciesCount:5},{name:"Santo Island",totalSightings:234,speciesCount:7},{name:"Malekula Island",totalSightings:198,speciesCount:4},{name:"Ambrym Island",totalSightings:89,speciesCount:3},{name:"Pentecost Island",totalSightings:64,speciesCount:2}],be={overview:"Overview","data-portal":"Data Portal","gis-database":"GIS Database",sightings:"Sightings",locations:"Locations",species:"Species",settings:"Settings"};function ge(){const[a,s]=i.useState("overview");return e.jsxs("div",{className:"app-layout",children:[e.jsx(le,{activeSection:a,onNavigate:s}),e.jsxs("main",{className:"main-content",children:[e.jsx(ae,{title:be[a]??a}),e.jsxs("div",{className:"dashboard-content",children:[a==="overview"&&e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"stats-grid",children:je.map(l=>e.jsx(ie,{data:l},l.title))}),e.jsxs("div",{className:"dashboard-panels",children:[e.jsx(T,{sightings:V}),e.jsx(M,{locations:$})]})]}),a==="data-portal"&&e.jsx(me,{onNavigate:s}),a==="gis-database"&&e.jsx(xe,{onNavigate:s}),a==="sightings"&&e.jsx(T,{sightings:V}),a==="locations"&&e.jsx(M,{locations:$}),a==="species"&&e.jsx("div",{className:"placeholder-section",children:e.jsx("p",{children:"Species catalog coming soon."})}),a==="settings"&&e.jsx("div",{className:"placeholder-section",children:e.jsx("p",{children:"Settings page coming soon."})})]})]})]})}te.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(ge,{})}));
