import{j as e,r as c}from"./app-BACuaSRr.js";import{f as C,M as w,l as y,m as P,a as f,d as k,g as S,u as I}from"./MapViewer-CosjcAVy.js";import{D as E}from"./DatasetUpload-CVjx_Wee.js";import{A as L}from"./AttributeTable-BAMLznSE.js";/* empty css                   */const B={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[168.3273,-17.7333]},properties:{species:"Acropora millepora",count:45,observer:"Dr. Tari",date:"2026-02-07",location:"Efate Island",habitat:"Reef crest"}},{type:"Feature",geometry:{type:"Point",coordinates:[169.2833,-19.5167]},properties:{species:"Chelonia mydas",count:23,observer:"M. Kalsakau",date:"2026-02-06",location:"Tanna Island",habitat:"Nesting beach"}},{type:"Feature",geometry:{type:"Point",coordinates:[167.1667,-15.4333]},properties:{species:"Dugong dugon",count:3,observer:"Dr. Tari",date:"2026-02-05",location:"Santo Island",habitat:"Seagrass bed"}},{type:"Feature",geometry:{type:"Point",coordinates:[167.6833,-16.35]},properties:{species:"Porites lutea",count:67,observer:"J. Naupa",date:"2026-02-04",location:"Malekula Island",habitat:"Lagoon reef flat"}},{type:"Feature",geometry:{type:"Point",coordinates:[168.3119,-17.7417]},properties:{species:"Tridacna gigas",count:8,observer:"S. Vatu",date:"2026-02-03",location:"Efate Island",habitat:"Reef edge"}},{type:"Feature",geometry:{type:"Point",coordinates:[168.15,-16.2667]},properties:{species:"Acropora hyacinthus",count:34,observer:"R. Mele",date:"2026-02-01",location:"Ambrym Island",habitat:"Fringing reef"}},{type:"Feature",geometry:{type:"Point",coordinates:[168.1833,-15.7667]},properties:{species:"Eretmochelys imbricata",count:4,observer:"L. Bong",date:"2026-01-29",location:"Pentecost Island",habitat:"Coral reef slope"}},{type:"Feature",geometry:{type:"Point",coordinates:[168.3065,-17.7476]},properties:{species:"Hippocampus kuda",count:5,observer:"Dr. Tari",date:"2026-01-27",location:"Port Vila",habitat:"Mangrove channel"}}]},M={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[168.2,-17.6],[168.5,-17.6],[168.5,-17.85],[168.2,-17.85],[168.2,-17.6]]]},properties:{name:"Efate Island",province:"Shefa",area_km2:899,population:65e3,survey_status:"Complete"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[169.1,-19.4],[169.5,-19.4],[169.5,-19.65],[169.1,-19.65],[169.1,-19.4]]]},properties:{name:"Tanna Island",province:"Tafea",area_km2:550,population:29e3,survey_status:"In Progress"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[166.5,-15.1],[167.3,-15.1],[167.3,-15.7],[166.5,-15.7],[166.5,-15.1]]]},properties:{name:"Espiritu Santo",province:"Sanma",area_km2:3956,population:4e4,survey_status:"In Progress"}},{type:"Feature",geometry:{type:"Polygon",coordinates:[[[167.4,-16],[167.9,-16],[167.9,-16.6],[167.4,-16.6],[167.4,-16]]]},properties:{name:"Malekula Island",province:"Malampa",area_km2:2041,population:3e4,survey_status:"Planned"}}]},A={active:"badge badge-active",archived:"badge badge-archived",draft:"badge badge-draft"},U=({datasets:n,onView:d,onEdit:i,onDelete:o})=>n.length===0?e.jsx("div",{className:"portal-empty",children:e.jsx("p",{children:"No datasets yet. Upload a GeoJSON, CSV, or KML file to get started."})}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Format"}),e.jsx("th",{children:"Features"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Updated"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("button",{className:"link-button",onClick:()=>d(a.id),children:a.metadata.name}),a.metadata.description&&e.jsx("span",{className:"dataset-description",children:a.metadata.description})]}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-format",children:a.format.toUpperCase()})}),e.jsx("td",{children:a.featureCount.toLocaleString()}),e.jsx("td",{children:C(a.sizeBytes)}),e.jsx("td",{children:e.jsx("span",{className:A[a.metadata.status]??"badge",children:a.metadata.status})}),e.jsx("td",{children:new Date(a.updatedAt).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm",onClick:()=>d(a.id),title:"View dataset",children:"View"}),e.jsx("button",{className:"btn btn-sm",onClick:()=>i(a.id),title:"Edit metadata",children:"Edit"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>o(a.id),title:"Delete dataset",children:"Delete"})]})})]},a.id))})]})}),V=({dataset:n,onBack:d,onEdit:i,onDelete:o})=>{const{metadata:a,data:l,properties:u}=n;function x(){const p=JSON.stringify(l,null,2),m=new Blob([p],{type:"application/geo+json"}),j=URL.createObjectURL(m),h=document.createElement("a");h.href=j,h.download=`${a.name.replace(/\s+/g,"_")}.geojson`,h.click(),URL.revokeObjectURL(j)}return e.jsxs("div",{className:"dataset-detail",children:[e.jsxs("div",{className:"detail-header",children:[e.jsx("button",{className:"btn btn-sm",onClick:d,children:"â† Back"}),e.jsxs("div",{className:"detail-actions",children:[e.jsx("button",{className:"btn btn-sm",onClick:x,children:"Export GeoJSON"}),e.jsx("button",{className:"btn btn-sm",onClick:i,children:"Edit Metadata"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:o,children:"Delete"})]})]}),e.jsxs("div",{className:"detail-meta-card",children:[e.jsxs("div",{className:"detail-title-row",children:[e.jsx("h2",{children:a.name}),e.jsx("span",{className:`badge badge-${a.status}`,children:a.status})]}),a.description&&e.jsx("p",{className:"detail-description",children:a.description}),e.jsxs("div",{className:"detail-stats",children:[e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Format"}),e.jsx("span",{className:"detail-stat-value",children:n.format.toUpperCase()})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Features"}),e.jsx("span",{className:"detail-stat-value",children:n.featureCount.toLocaleString()})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Size"}),e.jsx("span",{className:"detail-stat-value",children:C(n.sizeBytes)})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"CRS"}),e.jsx("span",{className:"detail-stat-value",children:a.crs})]}),a.source&&e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Source"}),e.jsx("span",{className:"detail-stat-value",children:a.source})]}),a.license&&e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"License"}),e.jsx("span",{className:"detail-stat-value",children:a.license})]})]}),a.tags.length>0&&e.jsx("div",{className:"detail-tags",children:a.tags.map(p=>e.jsx("span",{className:"badge badge-tag",children:p},p))}),n.bbox&&e.jsxs("div",{className:"detail-bbox",children:[e.jsx("span",{className:"detail-stat-label",children:"Bounding Box"}),e.jsxs("code",{children:["[",n.bbox.map(p=>p.toFixed(4)).join(", "),"]"]})]})]}),e.jsxs("div",{className:"detail-map",children:[e.jsx("h3",{children:"Map Preview"}),e.jsx(w,{data:l,height:"450px"})]}),e.jsx(L,{data:l,properties:u})]})},T=["active","archived","draft"],R=({metadata:n,onSave:d,onCancel:i})=>{const[o,a]=c.useState(n.name),[l,u]=c.useState(n.description),[x,p]=c.useState(n.source),[m,j]=c.useState(n.license),[h,b]=c.useState(n.status),[g,v]=c.useState(n.crs),[s,r]=c.useState(n.tags.join(", "));function N(t){t.preventDefault();const D=s.split(",").map(F=>F.trim()).filter(Boolean);d({name:o,description:l,source:x,license:m,status:h,crs:g,tags:D})}return e.jsxs("div",{className:"editor-panel",children:[e.jsx("h3",{children:"Edit Dataset Metadata"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-name",children:"Name"}),e.jsx("input",{id:"edit-name",type:"text",value:o,onChange:t=>a(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-desc",children:"Description"}),e.jsx("textarea",{id:"edit-desc",value:l,onChange:t=>u(t.target.value),rows:3})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-source",children:"Source"}),e.jsx("input",{id:"edit-source",type:"text",value:x,onChange:t=>p(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-license",children:"License"}),e.jsx("input",{id:"edit-license",type:"text",value:m,onChange:t=>j(t.target.value),placeholder:"e.g. CC-BY-4.0"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-status",children:"Status"}),e.jsx("select",{id:"edit-status",value:h,onChange:t=>b(t.target.value),children:T.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-crs",children:"CRS"}),e.jsx("input",{id:"edit-crs",type:"text",value:g,onChange:t=>v(t.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-tags",children:"Tags (comma-separated)"}),e.jsx("input",{id:"edit-tags",type:"text",value:s,onChange:t=>r(t.target.value),placeholder:"vcap2, marine, vanuatu, survey"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:i,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Changes"})]})]})]})},$=({onNavigate:n})=>{const[d,i]=c.useState("list"),[o,a]=c.useState([]),[l,u]=c.useState(null),[x,p]=c.useState(!0),m=c.useCallback(async()=>{const s=await y();a(s)},[]);c.useEffect(()=>{let s=!1;return P().then(async()=>{if(s)return;const r=await y();s||a(r)}).finally(()=>{s||p(!1)}),()=>{s=!0}},[m]);async function j(s){const r=await S(s);r?(u(r),i("detail")):(u(null),i("list"))}async function h(s){const r=await S(s);r?(u(r),i("edit")):(u(null),i("list"))}async function b(s){const r=o.find(t=>t.id===s);window.confirm(`Delete dataset "${r?.metadata.name??s}"? This cannot be undone.`)&&(await k(s),await m(),l?.id===s&&(u(null),i("list")))}async function g(s){if(!l)return;const r=await I(l.id,s);r&&(u(r),await m(),i("detail"))}async function v(){(await y()).some(r=>r.metadata.name==="VCAP2 Survey Points")||(await f(B,{name:"VCAP2 Survey Points",description:"Marine survey observation points across Vanuatu islands",source:"DEPC Field Survey 2026",tags:["vcap2","marine","survey","vanuatu"]},"geojson"),await f(M,{name:"Island Survey Boundaries",description:"Survey area boundaries for major Vanuatu islands",source:"National GIS Office",tags:["boundaries","islands","survey-areas"]},"geojson"),await m())}return x?e.jsx("div",{className:"data-portal",children:e.jsx("div",{className:"portal-toolbar",children:e.jsxs("div",{className:"portal-toolbar-left",children:[e.jsx("h2",{children:"GIS Data Portal"}),e.jsx("span",{className:"dataset-count",children:"Loading..."})]})})}):e.jsxs("div",{className:"data-portal",children:[d==="list"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"portal-toolbar",children:[e.jsxs("div",{className:"portal-toolbar-left",children:[e.jsx("h2",{children:"GIS Data Portal"}),e.jsxs("span",{className:"dataset-count",children:[o.length," dataset",o.length!==1?"s":""]})]}),e.jsxs("div",{className:"portal-toolbar-right",children:[o.length===0&&e.jsx("button",{className:"btn btn-secondary",onClick:v,children:"Load Sample Data"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>i("upload"),children:"Upload Dataset"})]})]}),o.length>0&&n&&e.jsxs("div",{className:"db-import-status",style:{marginBottom:"1rem"},children:["All datasets are stored in the GIS Database.",e.jsx("button",{className:"btn btn-sm",style:{marginLeft:"auto"},onClick:()=>n("gis-database"),children:"Open GIS Database"})]}),e.jsx(U,{datasets:o,onView:j,onEdit:h,onDelete:b})]}),d==="upload"&&e.jsx(E,{onUploaded:async()=>{await m(),i("list")},onCancel:()=>i("list")}),d==="detail"&&l&&e.jsx(V,{dataset:l,onBack:()=>{u(null),i("list")},onEdit:()=>i("edit"),onDelete:()=>b(l.id)}),d==="edit"&&l&&e.jsx(R,{metadata:l.metadata,onSave:g,onCancel:()=>i(l?"detail":"list")})]})};export{$ as default};
