import{r as a,j as e}from"./app-C1Aq88vy.js";import{p as E,c as O,h as z,a as K}from"./MapViewer-CqUgl5gi.js";function N(c){const n=c.split(".").pop()?.toLowerCase();return n==="geojson"||n==="json"?"geojson":n==="csv"?"csv":n==="kml"?"kml":null}const G=({onUploaded:c,onCancel:n})=>{const[d,m]=a.useState(""),[f,S]=a.useState(""),[h,k]=a.useState(""),[r,y]=a.useState(null),[x,o]=a.useState(""),[j,g]=a.useState(!1),[C,u]=a.useState(!1),[v,F]=a.useState("latitude"),[b,L]=a.useState("longitude"),p=a.useRef(null),l=r?N(r.name):null;function D(t){if(!N(t.name)){o("Unsupported file format. Please use .geojson, .json, .csv, or .kml");return}y(t),o(""),d||m(t.name.replace(/\.[^.]+$/,""))}function w(t){t.preventDefault(),u(!1);const s=t.dataTransfer.files[0];s&&D(s)}async function U(t){if(t.preventDefault(),!(!r||!l)){g(!0),o("");try{const s=await r.text();let i;switch(l){case"geojson":i=z(s);break;case"csv":i=O(s,v,b);break;case"kml":i=E(s);break}await K(i,{name:d,description:f,source:h},l),c()}catch(s){o(s instanceof Error?s.message:"Failed to parse file")}finally{g(!1)}}}return e.jsxs("div",{className:"upload-panel",children:[e.jsx("h3",{children:"Upload Dataset"}),e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:`drop-zone ${C?"drag-over":""} ${r?"has-file":""}`,onDragOver:t=>{t.preventDefault(),u(!0)},onDragLeave:()=>u(!1),onDrop:w,onClick:()=>p.current?.click(),role:"button",tabIndex:0,onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),p.current?.click())},children:[e.jsx("input",{ref:p,type:"file",accept:".geojson,.json,.csv,.kml",onChange:t=>{const s=t.target.files?.[0];s&&D(s)},hidden:!0}),r?e.jsxs("div",{className:"drop-zone-file",children:[e.jsx("span",{className:"badge badge-format",children:l?.toUpperCase()}),e.jsx("span",{children:r.name})]}):e.jsxs("div",{className:"drop-zone-prompt",children:[e.jsx("p",{children:"Drag & drop a file here, or click to browse"}),e.jsx("p",{className:"drop-zone-hint",children:"Supports GeoJSON, CSV, KML"})]})]}),l==="csv"&&e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lat-field",children:"Latitude Column"}),e.jsx("input",{id:"lat-field",type:"text",value:v,onChange:t=>F(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lng-field",children:"Longitude Column"}),e.jsx("input",{id:"lng-field",type:"text",value:b,onChange:t=>L(t.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ds-name",children:"Name"}),e.jsx("input",{id:"ds-name",type:"text",value:d,onChange:t=>m(t.target.value),placeholder:"Dataset name",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ds-desc",children:"Description"}),e.jsx("textarea",{id:"ds-desc",value:f,onChange:t=>S(t.target.value),placeholder:"Brief description of the dataset",rows:2})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"ds-source",children:"Source"}),e.jsx("input",{id:"ds-source",type:"text",value:h,onChange:t=>k(t.target.value),placeholder:"Data source or provider"})]}),x&&e.jsx("div",{className:"form-error",role:"alert",children:x}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!r||j,children:j?"Uploading...":"Upload Dataset"})]})]})]})};export{G as D};
