import{j as a,r as l}from"./app-xDPf3AKk.js";import{f as p,M as u,l as N,m as v,g}from"./MapViewer-k49t5Gix.js";import{A as f}from"./AttributeTable-CTSgBrcd.js";const y=({datasets:s,onView:i})=>a.jsx("div",{className:"table-container",children:a.jsxs("table",{className:"data-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Name"}),a.jsx("th",{children:"Format"}),a.jsx("th",{children:"Features"}),a.jsx("th",{children:"Size"}),a.jsx("th",{children:"Updated"}),a.jsx("th",{children:"Actions"})]})}),a.jsx("tbody",{children:s.map(e=>a.jsxs("tr",{children:[a.jsxs("td",{children:[a.jsx("button",{className:"link-button",onClick:()=>i(e.id),children:e.metadata.name}),e.metadata.description&&a.jsx("span",{className:"dataset-description",children:e.metadata.description})]}),a.jsx("td",{children:a.jsx("span",{className:"badge badge-format",children:e.format.toUpperCase()})}),a.jsx("td",{children:e.featureCount.toLocaleString()}),a.jsx("td",{children:p(e.sizeBytes)}),a.jsx("td",{children:new Date(e.updatedAt).toLocaleDateString()}),a.jsx("td",{children:a.jsx("div",{className:"action-buttons",children:a.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>i(e.id),title:"View dataset on map",children:"View on Map"})})})]},e.id))})]})}),D=({dataset:s,onBack:i})=>{const{metadata:e,data:d,properties:o}=s;function h(){const t=JSON.stringify(d,null,2),x=new Blob([t],{type:"application/geo+json"}),c=URL.createObjectURL(x),r=document.createElement("a");r.href=c,r.download=`${e.name.replace(/\s+/g,"_")}.geojson`,r.click(),URL.revokeObjectURL(c)}return a.jsxs("div",{className:"dataset-detail",children:[a.jsxs("div",{className:"detail-header",children:[a.jsx("button",{className:"btn btn-sm",onClick:i,children:"â† Back to Datasets"}),a.jsx("div",{className:"detail-actions",children:a.jsx("button",{className:"btn btn-sm btn-primary",onClick:h,children:"Download GeoJSON"})})]}),a.jsxs("div",{className:"detail-meta-card",children:[a.jsxs("div",{className:"detail-title-row",children:[a.jsx("h2",{children:e.name}),a.jsx("span",{className:"badge badge-active",children:"Published"})]}),e.description&&a.jsx("p",{className:"detail-description",children:e.description}),a.jsxs("div",{className:"detail-stats",children:[a.jsxs("div",{className:"detail-stat",children:[a.jsx("span",{className:"detail-stat-label",children:"Format"}),a.jsx("span",{className:"detail-stat-value",children:s.format.toUpperCase()})]}),a.jsxs("div",{className:"detail-stat",children:[a.jsx("span",{className:"detail-stat-label",children:"Features"}),a.jsx("span",{className:"detail-stat-value",children:s.featureCount.toLocaleString()})]}),a.jsxs("div",{className:"detail-stat",children:[a.jsx("span",{className:"detail-stat-label",children:"Size"}),a.jsx("span",{className:"detail-stat-value",children:p(s.sizeBytes)})]}),a.jsxs("div",{className:"detail-stat",children:[a.jsx("span",{className:"detail-stat-label",children:"CRS"}),a.jsx("span",{className:"detail-stat-value",children:e.crs})]}),e.source&&a.jsxs("div",{className:"detail-stat",children:[a.jsx("span",{className:"detail-stat-label",children:"Source"}),a.jsx("span",{className:"detail-stat-value",children:e.source})]}),e.license&&a.jsxs("div",{className:"detail-stat",children:[a.jsx("span",{className:"detail-stat-label",children:"License"}),a.jsx("span",{className:"detail-stat-value",children:e.license})]})]}),e.tags.length>0&&a.jsx("div",{className:"detail-tags",children:e.tags.map(t=>a.jsx("span",{className:"badge badge-tag",children:t},t))}),s.bbox&&a.jsxs("div",{className:"detail-bbox",children:[a.jsx("span",{className:"detail-stat-label",children:"Bounding Box"}),a.jsxs("code",{children:["[",s.bbox.map(t=>t.toFixed(4)).join(", "),"]"]})]})]}),a.jsxs("div",{className:"detail-map",children:[a.jsx("h3",{children:"Map Preview"}),a.jsx(u,{data:d,height:"450px"})]}),a.jsx(f,{data:d,properties:o})]})},L=()=>{const[s,i]=l.useState("list"),[e,d]=l.useState([]),[o,h]=l.useState(null),[t,x]=l.useState(!0),[c,r]=l.useState(""),j=l.useCallback(async()=>{const n=await N();d(n.filter(m=>m.metadata.status==="active"))},[]);l.useEffect(()=>{let n=!1;return v().then(()=>j()).catch(()=>{n||r("Unable to load datasets. Please try refreshing the page.")}).finally(()=>{n||x(!1)}),()=>{n=!0}},[j]);const b=l.useCallback(async n=>{const m=await g(n);m&&(h(m),i("detail"))},[]);return t?a.jsx("div",{className:"data-portal",children:a.jsx("div",{className:"portal-toolbar",children:a.jsxs("div",{className:"portal-toolbar-left",children:[a.jsx("h2",{children:"Published Datasets"}),a.jsx("span",{className:"dataset-count",children:"Loading..."})]})})}):a.jsxs("div",{className:"data-portal",children:[c&&a.jsx("div",{className:"form-error",role:"alert",children:c}),s==="list"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"portal-toolbar",children:[a.jsxs("div",{className:"portal-toolbar-left",children:[a.jsx("h2",{children:"Published Datasets"}),a.jsxs("span",{className:"dataset-count",children:[e.length," dataset",e.length!==1?"s":""," available"]})]}),a.jsx("div",{className:"portal-toolbar-right",children:a.jsx("span",{className:"public-read-only-badge",children:"Read-Only"})})]}),e.length===0&&!c?a.jsxs("div",{className:"portal-empty",children:[a.jsx("p",{children:"No published datasets available yet."}),a.jsx("p",{style:{fontSize:"0.85rem",marginTop:"0.5rem"},children:"Datasets will appear here once they are published by DEPC staff."})]}):a.jsx(y,{datasets:e,onView:b})]}),s==="detail"&&o&&a.jsx(D,{dataset:o,onBack:()=>{h(null),i("list")}})]})};export{L as default};
