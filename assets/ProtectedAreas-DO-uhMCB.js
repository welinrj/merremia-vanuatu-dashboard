import{r as t,j as e}from"./app-C1Aq88vy.js";import{b as U,l as z,f as $,c as I,u as O,d as V,e as J,h as q,i as _,a as K,j as W,r as Y}from"./GISDatabase-CS9kUfz1.js";import{M as Q,h as X}from"./MapViewer-CqUgl5gi.js";/* empty css                   */const H={proposed:"Proposed",designated:"Designated",active:"Active",inactive:"Inactive"},R={cca:"CCA",mpa:"MPA"},Z=["Malampa","Penama","Sanma","Shefa","Tafea","Torba"],re=()=>{const[s,d]=t.useState("dashboard"),[i,h]=t.useState([]),[o,c]=t.useState(null),[f,p]=t.useState(!0),[j,N]=t.useState(""),[r,x]=t.useState(""),[S,y]=t.useState(!1),[C,m]=t.useState(""),[w,A]=t.useState(null);t.useEffect(()=>{const a=U();A(a.lastSync)},[]);const v=t.useCallback(async()=>{const a=await z();h(a)},[]);t.useEffect(()=>{v().finally(()=>p(!1))},[v]);async function P(a){const l=await I(a);l&&(c(l),d("detail"))}async function B(a){const l=await I(a);l&&(c(l),d("edit"))}async function D(a){const l=i.find(u=>u.id===a);window.confirm(`Delete "${l?.name}"? This cannot be undone.`)&&(await q(a),o?.id===a&&(c(null),d("dashboard")),await v())}async function F(){const a=K();y(!0),m("Syncing with GitHub...");try{const l=await J(a);await v();const u=[];l.pushed>0&&u.push(`${l.pushed} pushed`),l.pulled>0&&u.push(`${l.pulled} pulled`),l.errors.length>0&&u.push(`${l.errors.length} error${l.errors.length!==1?"s":""}`),u.length===0&&u.push("Already in sync"),m(u.join(", ")),A(new Date().toISOString())}catch(l){m(l instanceof Error?l.message:"Sync failed")}finally{y(!1)}}const b=i.filter(a=>!(j&&a.type!==j||r&&a.status!==r)),M=i.filter(a=>a.type==="cca").length,k=i.filter(a=>a.type==="mpa").length,g=i.filter(a=>a.status==="active"||a.status==="designated").length,E=i.reduce((a,l)=>a+(l.areaHa??0),0);return f?e.jsx("div",{className:"data-portal",children:e.jsx("div",{className:"portal-toolbar",children:e.jsxs("div",{className:"portal-toolbar-left",children:[e.jsx("h2",{children:"CCAs & MPAs"}),e.jsx("span",{className:"dataset-count",children:"Loading..."})]})})}):s==="dashboard"?e.jsxs("div",{className:"data-portal",children:[e.jsxs("div",{className:"portal-toolbar",children:[e.jsxs("div",{className:"portal-toolbar-left",children:[e.jsx("h2",{children:"CCAs & MPAs"}),e.jsxs("span",{className:"dataset-count",children:[i.length," protected area",i.length!==1?"s":""]})]}),e.jsx("div",{className:"portal-toolbar-right",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{c(null),d("create")},children:"Add Protected Area"})})]}),e.jsxs("div",{className:"db-stats-grid",children:[e.jsxs("div",{className:"db-stat-card",children:[e.jsx("span",{className:"db-stat-value",children:M}),e.jsx("span",{className:"db-stat-label",children:"Community Conservation Areas"})]}),e.jsxs("div",{className:"db-stat-card",children:[e.jsx("span",{className:"db-stat-value",children:k}),e.jsx("span",{className:"db-stat-label",children:"Marine Protected Areas"})]}),e.jsxs("div",{className:"db-stat-card",children:[e.jsx("span",{className:"db-stat-value",children:g}),e.jsx("span",{className:"db-stat-label",children:"Active / Designated"})]}),e.jsxs("div",{className:"db-stat-card",children:[e.jsx("span",{className:"db-stat-value",children:$(E)}),e.jsx("span",{className:"db-stat-label",children:"Total Area"})]})]}),e.jsxs("div",{className:"db-sync-section",children:[e.jsxs("div",{className:"db-sync-row",children:[e.jsxs("div",{className:"db-sync-info",children:[e.jsx("strong",{children:"GitHub Sync"}),w&&e.jsxs("span",{className:"db-sync-last",children:["Last sync: ",new Date(w).toLocaleString()]})]}),e.jsx("div",{className:"db-sync-actions",children:e.jsx("button",{className:"btn btn-sm btn-primary",onClick:F,disabled:S,children:S?"Syncing...":"Sync Now"})})]}),C&&e.jsxs("div",{className:"db-sync-status",role:"status",children:[C,e.jsx("button",{className:"db-dismiss",onClick:()=>m(""),"aria-label":"Dismiss",children:"×"})]})]}),i.length>0&&e.jsxs("div",{className:"pa-filters",children:[e.jsxs("div",{className:"pa-filter-group",children:[e.jsx("label",{htmlFor:"filter-type",children:"Type"}),e.jsxs("select",{id:"filter-type",value:j,onChange:a=>N(a.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"cca",children:"CCA"}),e.jsx("option",{value:"mpa",children:"MPA"})]})]}),e.jsxs("div",{className:"pa-filter-group",children:[e.jsx("label",{htmlFor:"filter-status",children:"Status"}),e.jsxs("select",{id:"filter-status",value:r,onChange:a=>x(a.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"proposed",children:"Proposed"}),e.jsx("option",{value:"designated",children:"Designated"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("span",{className:"pa-filter-count",children:["Showing ",b.length," of ",i.length]})]}),b.length===0?e.jsx("div",{className:"portal-empty",children:i.length===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"No protected areas registered yet."}),e.jsxs("p",{style:{fontSize:"0.85rem",marginTop:"0.5rem"},children:["Click ",e.jsx("strong",{children:"Add Protected Area"})," to register a CCA or MPA."]})]}):e.jsx("p",{children:"No protected areas match the current filters."})}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Island"}),e.jsx("th",{children:"Province"}),e.jsx("th",{children:"Area"}),e.jsx("th",{children:"Updated"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:b.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{className:"link-button",onClick:()=>P(a.id),children:a.name})}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-pa-type badge-pa-${a.type}`,children:R[a.type]})}),e.jsx("td",{children:e.jsx("span",{className:`badge badge-${a.status}`,children:H[a.status]})}),e.jsx("td",{children:a.island||"—"}),e.jsx("td",{children:a.province||"—"}),e.jsx("td",{children:$(a.areaHa)}),e.jsx("td",{children:new Date(a.updatedAt).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm",onClick:()=>B(a.id),children:"Edit"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>D(a.id),children:"Delete"})]})})]},a.id))})]})})]}):s==="detail"&&o?e.jsx(ee,{area:o,onBack:()=>{c(null),d("dashboard")},onEdit:()=>d("edit"),onDelete:()=>D(o.id),onRefresh:async()=>{const a=await I(o.id);a&&c(a)}}):s==="create"||s==="edit"?e.jsx(se,{existing:s==="edit"?o:null,onSave:async a=>{s==="edit"&&o?await O(o.id,a):await V(a),await v(),c(null),d("dashboard")},onCancel:()=>d(o?"detail":"dashboard")}):null},ee=({area:s,onBack:d,onEdit:i,onDelete:h,onRefresh:o})=>{const c=t.useRef(null),[f,p]=t.useState(!1);async function j(r){const x=r.target.files?.[0];x&&(p(!0),await W(s.id,x),await o(),p(!1),c.current&&(c.current.value=""))}async function N(r){window.confirm("Remove this attachment?")&&(await Y(s.id,r),await o())}return e.jsxs("div",{className:"data-portal",children:[e.jsxs("div",{className:"detail-header",children:[e.jsx("button",{className:"btn btn-secondary",onClick:d,children:"← Back to List"}),e.jsxs("div",{className:"detail-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Edit"}),e.jsx("button",{className:"btn btn-danger",onClick:h,children:"Delete"})]})]}),e.jsxs("div",{className:"detail-meta-card",children:[e.jsxs("div",{className:"detail-title-row",children:[e.jsx("h2",{children:s.name}),e.jsx("span",{className:`badge badge-pa-type badge-pa-${s.type}`,children:R[s.type]}),e.jsx("span",{className:`badge badge-${s.status}`,children:H[s.status]})]}),s.description&&e.jsx("p",{className:"detail-description",children:s.description}),e.jsxs("div",{className:"detail-stats",children:[e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Island"}),e.jsx("span",{className:"detail-stat-value",children:s.island||"—"})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Province"}),e.jsx("span",{className:"detail-stat-value",children:s.province||"—"})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Area"}),e.jsx("span",{className:"detail-stat-value",children:$(s.areaHa)})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Designated"}),e.jsx("span",{className:"detail-stat-value",children:s.designatedDate||"—"})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Management"}),e.jsx("span",{className:"detail-stat-value",children:s.managementAuthority||"—"})]}),e.jsxs("div",{className:"detail-stat",children:[e.jsx("span",{className:"detail-stat-label",children:"Created"}),e.jsx("span",{className:"detail-stat-value",children:new Date(s.createdAt).toLocaleDateString()})]})]})]}),s.boundary&&s.boundary.features.length>0&&e.jsxs("div",{className:"detail-map",children:[e.jsx("h3",{children:"Boundary Map"}),e.jsx(Q,{data:s.boundary,height:"400px"})]}),e.jsxs("div",{className:"pa-attachments-card",children:[e.jsxs("div",{className:"pa-attachments-header",children:[e.jsxs("h3",{children:["Attachments (",s.attachments.length,")"]}),e.jsxs("div",{children:[e.jsx("input",{ref:c,type:"file",accept:".pdf,.doc,.docx,.png,.jpg,.jpeg,.geojson,.json,.csv,.kml,.zip",onChange:j,hidden:!0}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>c.current?.click(),disabled:f,children:f?"Uploading...":"Upload File"})]})]}),s.attachments.length===0?e.jsx("p",{className:"pa-attachments-empty",children:"No attachments yet."}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"File Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.attachments.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.name}),e.jsx("td",{children:r.mimeType||"—"}),e.jsx("td",{children:ae(r.sizeBytes)}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn btn-sm",onClick:()=>_(r),children:"Download"}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>N(r.id),children:"Remove"})]})})]},r.id))})]})]})]})};function ae(s){if(s===0)return"0 B";const d=1024,i=["B","KB","MB","GB"],h=Math.floor(Math.log(s)/Math.log(d));return`${parseFloat((s/Math.pow(d,h)).toFixed(1))} ${i[h]}`}const se=({existing:s,onSave:d,onCancel:i})=>{const[h,o]=t.useState(s?.name??""),[c,f]=t.useState(s?.type??"cca"),[p,j]=t.useState(s?.status??"proposed"),[N,r]=t.useState(s?.description??""),[x,S]=t.useState(s?.island??""),[y,C]=t.useState(s?.province??""),[m,w]=t.useState(s?.areaHa?.toString()??""),[A,v]=t.useState(s?.designatedDate??""),[P,B]=t.useState(s?.managementAuthority??""),[D,F]=t.useState(s?.boundary??null),[b,M]=t.useState(""),[k,g]=t.useState(""),[E,a]=t.useState(!1);function l(n){const T=n.target.files?.[0];if(!T)return;const L=new FileReader;L.onload=()=>{try{const G=X(L.result);F(G),M(T.name),g("")}catch{g("Invalid GeoJSON boundary file."),F(null),M("")}},L.readAsText(T)}async function u(n){if(n.preventDefault(),!h.trim()){g("Name is required.");return}a(!0),g("");try{await d({name:h.trim(),type:c,status:p,description:N.trim(),island:x.trim(),province:y,areaHa:m?parseFloat(m):null,designatedDate:A,managementAuthority:P.trim(),boundary:D})}catch{g("Failed to save. Please try again."),a(!1)}}return e.jsx("div",{className:"data-portal",children:e.jsxs("div",{className:"upload-panel",style:{maxWidth:"720px"},children:[e.jsx("h3",{children:s?"Edit Protected Area":"Add Protected Area"}),k&&e.jsx("div",{className:"form-error",children:k}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-name",children:"Name *"}),e.jsx("input",{id:"pa-name",type:"text",value:h,onChange:n=>o(n.target.value),placeholder:"e.g. Nguna-Pele Marine Protected Area",required:!0})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-type",children:"Type"}),e.jsxs("select",{id:"pa-type",value:c,onChange:n=>f(n.target.value),children:[e.jsx("option",{value:"cca",children:"CCA — Community Conservation Area"}),e.jsx("option",{value:"mpa",children:"MPA — Marine Protected Area"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-status",children:"Status"}),e.jsxs("select",{id:"pa-status",value:p,onChange:n=>j(n.target.value),children:[e.jsx("option",{value:"proposed",children:"Proposed"}),e.jsx("option",{value:"designated",children:"Designated"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-desc",children:"Description"}),e.jsx("textarea",{id:"pa-desc",value:N,onChange:n=>r(n.target.value),rows:3,placeholder:"Brief description of the protected area"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-island",children:"Island"}),e.jsx("input",{id:"pa-island",type:"text",value:x,onChange:n=>S(n.target.value),placeholder:"e.g. Efate"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-province",children:"Province"}),e.jsxs("select",{id:"pa-province",value:y,onChange:n=>C(n.target.value),children:[e.jsx("option",{value:"",children:"Select province"}),Z.map(n=>e.jsx("option",{value:n,children:n},n))]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-area",children:"Area (hectares)"}),e.jsx("input",{id:"pa-area",type:"number",step:"0.1",min:"0",value:m,onChange:n=>w(n.target.value),placeholder:"e.g. 1250"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-date",children:"Designated Date"}),e.jsx("input",{id:"pa-date",type:"date",value:A,onChange:n=>v(n.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-mgmt",children:"Management Authority"}),e.jsx("input",{id:"pa-mgmt",type:"text",value:P,onChange:n=>B(n.target.value),placeholder:"e.g. DEPC / Community Council"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"pa-boundary",children:"Boundary (GeoJSON)"}),e.jsx("input",{id:"pa-boundary",type:"file",accept:".geojson,.json",onChange:l}),b&&e.jsxs("span",{className:"pa-boundary-file",children:["Loaded: ",b]}),s?.boundary&&!b&&e.jsxs("span",{className:"pa-boundary-file",children:["Existing boundary (",s.boundary.features.length," feature",s.boundary.features.length!==1?"s":"",")"]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:i,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:E,children:E?"Saving...":s?"Save Changes":"Create"})]})]})]})})};export{re as default};
