<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VCAP2 GIS Data Portal</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/shpjs@4.0.4/dist/shp.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif; background: #0f172a; color: #e2e8f0; height: 100vh; display: flex; flex-direction: column; }

  /* Header */
  .header { background: linear-gradient(135deg, #052e23 0%, #064e3b 50%, #065f46 100%); padding: 0.75rem 1.5rem; display: flex; align-items: center; gap: 1rem; border-bottom: 1px solid rgba(16,185,129,0.3); z-index: 1000; }
  .header h1 { font-size: 1.1rem; font-weight: 700; color: #ecfdf5; letter-spacing: -0.01em; }
  .header .subtitle { font-size: 0.72rem; color: rgba(110,231,183,0.7); }
  .header-nav { margin-left: auto; display: flex; gap: 0.5rem; }
  .header-nav a { color: #a7f3d0; text-decoration: none; font-size: 0.78rem; font-weight: 600; padding: 0.35rem 0.75rem; border-radius: 0.35rem; transition: all 0.2s; border: 1px solid transparent; }
  .header-nav a:hover, .header-nav a.active { background: rgba(16,185,129,0.15); border-color: rgba(16,185,129,0.3); color: #ecfdf5; }

  /* Layout */
  .main { flex: 1; display: flex; overflow: hidden; }
  .sidebar { width: 340px; background: #1e293b; border-right: 1px solid #334155; display: flex; flex-direction: column; overflow: hidden; flex-shrink: 0; }
  .map-container { flex: 1; position: relative; }
  #map { width: 100%; height: 100%; }

  /* Sidebar sections */
  .sidebar-header { padding: 0.75rem 1rem; background: #0f172a; border-bottom: 1px solid #334155; display: flex; align-items: center; justify-content: space-between; }
  .sidebar-header h2 { font-size: 0.82rem; font-weight: 700; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.06em; }
  .sidebar-body { flex: 1; overflow-y: auto; padding: 0.75rem; }

  /* Upload area */
  .upload-zone { border: 2px dashed #334155; border-radius: 0.5rem; padding: 1.25rem; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 0.75rem; }
  .upload-zone:hover, .upload-zone.dragover { border-color: #10b981; background: rgba(16,185,129,0.05); }
  .upload-zone .icon { font-size: 1.5rem; margin-bottom: 0.35rem; }
  .upload-zone .label { font-size: 0.78rem; color: #94a3b8; }
  .upload-zone .formats { font-size: 0.68rem; color: #64748b; margin-top: 0.25rem; }
  .upload-zone input { display: none; }

  /* Dataset list */
  .dataset-item { background: #0f172a; border: 1px solid #334155; border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.2s; }
  .dataset-item:hover { border-color: #10b981; }
  .dataset-item.active { border-color: #10b981; background: rgba(16,185,129,0.08); }
  .dataset-item .ds-name { font-size: 0.82rem; font-weight: 600; color: #f1f5f9; margin-bottom: 0.2rem; }
  .dataset-item .ds-meta { font-size: 0.7rem; color: #64748b; display: flex; gap: 0.75rem; }
  .dataset-item .ds-meta span { display: flex; align-items: center; gap: 0.2rem; }
  .dataset-actions { display: flex; gap: 0.35rem; margin-top: 0.4rem; }
  .ds-btn { font-size: 0.68rem; padding: 0.2rem 0.5rem; border-radius: 0.25rem; border: 1px solid #334155; background: #1e293b; color: #94a3b8; cursor: pointer; transition: all 0.2s; }
  .ds-btn:hover { border-color: #10b981; color: #10b981; }
  .ds-btn.danger:hover { border-color: #ef4444; color: #ef4444; }

  /* Status bar */
  .status-bar { padding: 0.4rem 1rem; background: #0f172a; border-top: 1px solid #334155; font-size: 0.7rem; color: #64748b; display: flex; justify-content: space-between; }

  /* Attribute table panel */
  .attr-panel { position: absolute; bottom: 0; left: 0; right: 0; background: #1e293b; border-top: 2px solid #10b981; max-height: 250px; overflow: auto; z-index: 500; display: none; }
  .attr-panel.open { display: block; }
  .attr-panel-header { position: sticky; top: 0; background: #0f172a; padding: 0.5rem 1rem; display: flex; justify-content: space-between; align-items: center; z-index: 1; }
  .attr-panel-header h3 { font-size: 0.78rem; color: #94a3b8; font-weight: 600; }
  .attr-close { background: none; border: none; color: #94a3b8; cursor: pointer; font-size: 1rem; }
  .attr-table { width: 100%; border-collapse: collapse; font-size: 0.72rem; }
  .attr-table th { background: #0f172a; color: #64748b; text-transform: uppercase; font-size: 0.65rem; letter-spacing: 0.05em; padding: 0.4rem 0.6rem; text-align: left; position: sticky; top: 32px; border-bottom: 1px solid #334155; }
  .attr-table td { padding: 0.35rem 0.6rem; border-bottom: 1px solid #1e293b; color: #cbd5e1; }
  .attr-table tr:hover td { background: rgba(16,185,129,0.05); }

  /* Toast */
  .toast { position: fixed; top: 80px; right: 20px; padding: 0.6rem 1rem; border-radius: 0.4rem; font-size: 0.78rem; font-weight: 600; z-index: 9999; animation: slideIn 0.3s ease; }
  .toast-success { background: #065f46; color: #a7f3d0; border: 1px solid #10b981; }
  .toast-error { background: #7f1d1d; color: #fca5a5; border: 1px solid #ef4444; }
  .toast-info { background: #1e3a5f; color: #93c5fd; border: 1px solid #3b82f6; }
  @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

  /* Loading */
  .loading-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15,23,42,0.7); display: flex; align-items: center; justify-content: center; z-index: 600; }
  .spinner { width: 32px; height: 32px; border: 3px solid #334155; border-top-color: #10b981; border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Empty state */
  .empty-state { text-align: center; padding: 2rem 1rem; color: #64748b; }
  .empty-state .icon { font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5; }
  .empty-state p { font-size: 0.78rem; }

  /* Basemap toggle */
  .basemap-toggle { position: absolute; bottom: 12px; right: 12px; z-index: 500; display: flex; gap: 4px; background: rgba(15,23,42,0.85); border-radius: 0.4rem; padding: 3px; border: 1px solid #334155; }
  .basemap-btn { font-size: 0.68rem; font-weight: 600; padding: 0.3rem 0.6rem; border: 1px solid transparent; border-radius: 0.3rem; background: none; color: #94a3b8; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
  .basemap-btn:hover { color: #e2e8f0; }
  .basemap-btn.active { background: #10b981; color: #fff; border-color: #10b981; }

  /* Responsive */
  @media (max-width: 768px) {
    .main { flex-direction: column; }
    .sidebar { width: 100%; max-height: 40vh; }
  }
</style>
</head>
<body>

<div class="header">
  <img src="vcap2-logo.svg" alt="VCAP2" style="width:40px;height:40px;flex-shrink:0">
  <div>
    <h1>VCAP2 GIS Data Portal</h1>
    <div class="subtitle">Vanuatu Climate Adaptation Project &mdash; Marine Conservation</div>
  </div>
  <nav class="header-nav">
    <a href="index.html" class="active">Map Portal</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="dashboard-overview.html">Overview</a>
    <a href="../nbsap-portal/">NBSAP 30x30</a>
    <a href="../">Main Dashboard</a>
  </nav>
</div>

<div class="main">
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Datasets</h2>
      <span id="dataset-count" style="font-size:0.7rem;color:#64748b">0 datasets</span>
    </div>
    <div class="sidebar-body">
      <div class="upload-zone" id="upload-zone">
        <div class="icon">&#128194;</div>
        <div class="label">Drop files here or click to upload</div>
        <div class="formats">GeoJSON, KML, Shapefile (.zip)</div>
        <input type="file" id="file-input" accept=".geojson,.json,.kml,.zip" multiple>
      </div>
      <div id="dataset-list"></div>
      <div class="empty-state" id="empty-state" style="display:none">
        <div class="icon">&#127757;</div>
        <p>No datasets loaded yet.<br>Upload GIS files or wait for data to load from GitHub.</p>
      </div>
    </div>
  </div>

  <div class="map-container">
    <div id="map"></div>
    <div class="basemap-toggle" id="basemap-toggle">
      <button class="basemap-btn active" data-basemap="dark">Dark</button>
      <button class="basemap-btn" data-basemap="satellite">Satellite</button>
      <button class="basemap-btn" data-basemap="streets">Streets</button>
    </div>
    <div class="attr-panel" id="attr-panel">
      <div class="attr-panel-header">
        <h3 id="attr-title">Attribute Table</h3>
        <button class="attr-close" onclick="closeAttrPanel()">&times;</button>
      </div>
      <table class="attr-table" id="attr-table">
        <thead id="attr-thead"></thead>
        <tbody id="attr-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="status-bar">
  <span id="status-text">Initializing...</span>
  <span id="status-coords"></span>
</div>

<script src="app.js"></script>
</body>
</html>
